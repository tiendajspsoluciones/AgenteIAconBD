{
  "name": "AI Agent with PostgreSQL & MCP for Hardware Store Chatbot",
  "nodes": [
    {
      "parameters": {
        "path": "servidorbasesdedatos"
      },
      "type": "@n8n/n8n-nodes-langchain.mcpTrigger",
      "typeVersion": 2,
      "position": [
        -464,
        368
      ],
      "id": "fbc411f2-3338-4a02-b72d-ab543374fbfc",
      "name": "Database Tools Trigger",
      "webhookId": "99ec287f-b754-4cb9-a91f-b302c1195ee9"
    },
    {
      "parameters": {
        "operation": "select",
        "schema": {
          "__rl": true,
          "mode": "list",
          "value": "public"
        },
        "table": {
          "__rl": true,
          "value": "productos",
          "mode": "list",
          "cachedResultName": "productos"
        },
        "where": {
          "values": [
            {
              "column": "id",
              "value": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('values0_Value', ``, 'string') }}"
            }
          ]
        },
        "combineConditions": "OR",
        "options": {}
      },
      "type": "n8n-nodes-base.postgresTool",
      "typeVersion": 2.6,
      "position": [
        -640,
        512
      ],
      "id": "01e12dad-723e-4363-94e4-6e44b0850ba1",
      "name": "Query Product by ID",
      "credentials": {
        "postgres": {
          "id": "nRKGlUfPkgPJYEww",
          "name": "bd_ferreteria"
        }
      }
    },
    {
      "parameters": {
        "operation": "select",
        "schema": {
          "__rl": true,
          "mode": "list",
          "value": "public"
        },
        "table": {
          "__rl": true,
          "value": "productos",
          "mode": "list",
          "cachedResultName": "productos"
        },
        "where": {
          "values": [
            {
              "column": "nombre",
              "value": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('values0_Value', ``, 'string') }}"
            }
          ]
        },
        "combineConditions": "OR",
        "options": {}
      },
      "type": "n8n-nodes-base.postgresTool",
      "typeVersion": 2.6,
      "position": [
        -448,
        560
      ],
      "id": "4ccc8c2d-3300-43cf-8ce2-cd919489fedb",
      "name": "Query Product by Name",
      "credentials": {
        "postgres": {
          "id": "nRKGlUfPkgPJYEww",
          "name": "bd_ferreteria"
        }
      }
    },
    {
      "parameters": {
        "operation": "select",
        "schema": {
          "__rl": true,
          "mode": "list",
          "value": "public"
        },
        "table": {
          "__rl": true,
          "value": "productos",
          "mode": "list",
          "cachedResultName": "productos"
        },
        "where": {
          "values": [
            {
              "column": "descripcion",
              "value": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('values0_Value', ``, 'string') }}"
            }
          ]
        },
        "combineConditions": "OR",
        "options": {}
      },
      "type": "n8n-nodes-base.postgresTool",
      "typeVersion": 2.6,
      "position": [
        -320,
        624
      ],
      "id": "8e9ffd6e-8b31-4c2a-b3ee-8ba4e7539469",
      "name": "Query Product by Description",
      "credentials": {
        "postgres": {
          "id": "nRKGlUfPkgPJYEww",
          "name": "bd_ferreteria"
        }
      }
    },
    {
      "parameters": {
        "operation": "select",
        "schema": {
          "__rl": true,
          "mode": "list",
          "value": "public"
        },
        "table": {
          "__rl": true,
          "value": "productos",
          "mode": "list",
          "cachedResultName": "productos"
        },
        "where": {
          "values": [
            {
              "column": "categoria",
              "value": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('values0_Value', ``, 'string') }}"
            }
          ]
        },
        "combineConditions": "OR",
        "options": {}
      },
      "type": "n8n-nodes-base.postgresTool",
      "typeVersion": 2.6,
      "position": [
        -208,
        528
      ],
      "id": "1a18188f-33a6-47bf-881f-d5fd4a263af5",
      "name": "Query Product by Category",
      "credentials": {
        "postgres": {
          "id": "nRKGlUfPkgPJYEww",
          "name": "bd_ferreteria"
        }
      }
    },
    {
      "parameters": {
        "operation": "select",
        "schema": {
          "__rl": true,
          "mode": "list",
          "value": "public"
        },
        "table": {
          "__rl": true,
          "value": "productos",
          "mode": "list",
          "cachedResultName": "productos"
        },
        "where": {
          "values": [
            {
              "column": "subcategoria",
              "value": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('values0_Value', ``, 'string') }}"
            }
          ]
        },
        "combineConditions": "OR",
        "options": {}
      },
      "type": "n8n-nodes-base.postgresTool",
      "typeVersion": 2.6,
      "position": [
        -64,
        496
      ],
      "id": "4a7b5cdf-8ada-432d-b12c-b991528c66e1",
      "name": "Query Product by Subcategory",
      "credentials": {
        "postgres": {
          "id": "nRKGlUfPkgPJYEww",
          "name": "bd_ferreteria"
        }
      }
    },
    {
      "parameters": {
        "operation": "select",
        "schema": {
          "__rl": true,
          "mode": "list",
          "value": "public"
        },
        "table": {
          "__rl": true,
          "value": "productos",
          "mode": "list",
          "cachedResultName": "productos"
        },
        "where": {
          "values": [
            {
              "column": "nota",
              "value": "={{ /*n8n-auto-generated-fromAI-override*/ $fromAI('values0_Value', ``, 'string') }}"
            }
          ]
        },
        "combineConditions": "OR",
        "options": {}
      },
      "type": "n8n-nodes-base.postgresTool",
      "typeVersion": 2.6,
      "position": [
        -112,
        352
      ],
      "id": "88060128-1221-44aa-816c-ae256e9683fe",
      "name": "Query Product by Note",
      "credentials": {
        "postgres": {
          "id": "nRKGlUfPkgPJYEww",
          "name": "bd_ferreteria"
        }
      }
    },
    {
      "parameters": {
        "public": true,
        "options": {
          "allowFileUploads": true,
          "showWelcomeScreen": true
        }
      },
      "type": "@n8n/n8n-nodes-langchain.chatTrigger",
      "typeVersion": 1.3,
      "position": [
        -112,
        112
      ],
      "id": "e9398c88-b894-4a3e-9c98-ce2347bfe967",
      "name": "Chat Trigger",
      "webhookId": "5cb3512c-5ed5-405e-a754-170e8edfaccb"
    },
    {
      "parameters": {
        "options": {
          "systemMessage": "Eres un asistente de ventas especializado en materiales de construcción para sistemas de drywall, plafones y acabados. Tu objetivo es ayudar a los clientes a encontrar productos, generar cotizaciones y asesorar en proyectos de construcción.\nTu Rol y Responsabilidades\n\nAsesor experto: Conoces profundamente los productos de tablaroca, perfiles metálicos, tornillería, acabados y sistemas de cielos falsos\nConsultor de proyectos: Ayudas a calcular materiales necesarios para proyectos específicos\nGenerador de cotizaciones: Proporcionas precios claros y totales detallados\nEducador: Explicas el uso correcto de cada producto y sus aplicaciones\n\nAcceso a Información de Productos\nTienes acceso a una base de datos PostgreSQL con la tabla productos que contiene:\n\nid: Identificador único del producto\nnombre: Nombre comercial del producto\ndescripcion: Descripción detallada y usos\nmedida_unidad: Unidad de venta (pza, rollo, cubeta, kg)\ndimensiones: Medidas físicas del producto\nexistencia: Cantidad disponible en inventario\nprecio_unidad: Precio por unidad en pesos mexicanos\ncategoria: Clasificación principal (Paneles, Perfiles Metálicos, Tornillería, Acabados, Aislamientos, Ferretería)\nsubcategoria: Clasificación específica\nrelacionados: IDs de productos complementarios\nnota: Información adicional importante\n\nCómo Usar la Herramienta MCP Client\nPuedes consultar productos usando diferentes criterios:\n\nPor ID: Cuando conozcas el número exacto del producto\nPor nombre: Para búsquedas por nombre comercial (ej: \"Tablaroca\", \"Canal\", \"Pija\")\nPor descripción: Para búsquedas más generales sobre características\nPor categoría: Para listar productos por tipo (Paneles, Perfiles Metálicos, Tornillería, etc.)\nPor subcategoría: Para búsquedas más específicas (Tablaroca, Canales, Postes, etc.)\nPor nota: Para información técnica específica\n\nGuías de Conversación\nConsultas de Productos\nCuando un cliente pregunte por un producto:\n\nBusca en la base de datos usando el criterio más apropiado\nProporciona nombre, descripción, precio y disponibilidad\nMenciona productos relacionados que puedan complementar la compra\nIncluye notas técnicas relevantes (medidas, calibres, aplicaciones)\n\nCotizaciones\nAl generar cotizaciones:\n\nLista cada producto con su nombre completo\nIndica cantidad solicitada y unidad de medida\nMuestra precio unitario y subtotal por producto\nCalcula el total general al final\nMenciona disponibilidad en existencias\nFormato claro y profesional\n\nEjemplo de cotización:\nCOTIZACIÓN\n\n1. Tablaroca Ultralight USG (1.22 x 2.44 m x 1/2\")\n   - Cantidad: 20 piezas\n   - Precio unitario: $240.00\n   - Subtotal: $4,800.00\n   \n2. Canal 6.35 Cal 26 (3.05 m)\n   - Cantidad: 10 piezas\n   - Precio unitario: $62.00\n   - Subtotal: $620.00\n\nTOTAL: $5,420.00\n\nNota: Verificar disponibilidad en inventario\nAsesoría para Proyectos\nCuando un cliente describa un proyecto (ej: \"quiero hacer un muro divisorio de 4x3 metros\"):\n\nIdentifica el tipo de proyecto: muro divisorio, cielo falso, área húmeda\nCalcula materiales necesarios:\n\nPaneles según área a cubrir (cada Tablaroca cubre ~2.97 m²)\nPerfiles metálicos según dimensiones y separación estándar\nTornillería según cantidad de paneles y uniones\nAcabados proporcionales al área\n\n\nRecomienda productos complementarios:\n\nAislamiento para mejor confort\nProductos relacionados según el tipo de proyecto\n\n\nProporciona cantidades aproximadas basadas en:\n\nPostes cada 40.6 o 61 cm\nPijas: aproximadamente 32 por panel de Tablaroca\nCompuesto: 1 cubeta de 21.8 kg cubre ~30-40 m² de junta\nCinta: 1 rollo de 76 m cubre ~20-25 paneles\n\n\nGenera cotización completa con todos los materiales\n\nÁreas Húmedas\nPara baños o cocinas, recomienda:\n\nDurock en lugar de Tablaroca tradicional\nPijas especiales para Durock (resistentes a corrosión)\nBasecoat USG para mejor acabado en paneles cementicios\n\nCielos Falsos/Plafones\nPara proyectos de cielos falsos, incluye:\n\nPerfiles principales (Canaleta de carga, Tee principal)\nPerfiles secundarios (Canal listón, Tee 1.22, Tee 61)\nAcabados perimetrales (Ángulo de amarre, Ángulo perimetral)\nPaneles de plafón (61x61 cm)\nSistema de suspensión (Alambre galvanizado)\n\nTono y Estilo\n\nProfesional pero cercano: Habla como un experto accesible\nClaro y directo: Evita tecnicismos innecesarios, explica cuando sea necesario\nProactivo: Sugiere productos complementarios y alternativas\nEducativo: Explica para qué sirve cada producto y cómo se usa\nPreciso con números: Verifica cálculos y proporciona cotizaciones exactas\n\nInformación Importante\n\nTodos los precios están en pesos mexicanos (MXN)\nSiempre verifica la existencia antes de confirmar disponibilidad\nSi un producto tiene existencia = 0, indica que está agotado y ofrece alternativas\nUsa las notas de cada producto para dar información técnica valiosa\nConsidera los productos relacionados para ventas complementarias\n\nLimitaciones\n\nNo inventes información que no esté en la base de datos\nSi no encuentras un producto, ofrécete a buscar por otros términos\nNo garantices tiempos de entrega ni políticas de devolución (eso lo maneja el área administrativa)\nPara consultas sobre instalación compleja, sugiere contactar a un profesional\n\n\nObjetivo Final: Proporcionar una experiencia de compra informada, ayudar a los clientes a encontrar exactamente lo que necesitan y asegurar que tengan todos los materiales para completar exitosamente sus proyectos."
        }
      },
      "type": "@n8n/n8n-nodes-langchain.agent",
      "typeVersion": 2.2,
      "position": [
        256,
        112
      ],
      "id": "fdaba65d-ebd9-40cf-8041-cb3b59de0a0f",
      "name": "AI Agent"
    },
    {
      "parameters": {
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.lmChatGoogleGemini",
      "typeVersion": 1,
      "position": [
        128,
        304
      ],
      "id": "3876074c-a9fd-4802-8b4c-8c1c7f3178d2",
      "name": "Language Model (Google Gemini)",
      "credentials": {
        "googlePalmApi": {
          "id": "OMOVcwsquEQ2tLh5",
          "name": "Google Gemini(PaLM) Api account"
        }
      }
    },
    {
      "parameters": {
        "contextWindowLength": 50
      },
      "type": "@n8n/n8n-nodes-langchain.memoryBufferWindow",
      "typeVersion": 1.3,
      "position": [
        288,
        336
      ],
      "id": "b93eaac2-2de5-425a-800c-07dfcca60afb",
      "name": "Chat Memory"
    },
    {
      "parameters": {
        "endpointUrl": "http://localhost:5678/mcp/servidorbasesdedatos",
        "options": {}
      },
      "type": "@n8n/n8n-nodes-langchain.mcpClientTool",
      "typeVersion": 1.1,
      "position": [
        448,
        336
      ],
      "id": "c247fa37-e815-4fbb-a954-98bf247527d5",
      "name": "DB Tools Client"
    },
    {
      "parameters": {
        "content": "## 📝 Descripción del Flujo / Workflow Description\n\nEste agente de IA conversacional responde preguntas sobre productos de ferretería. Utiliza un modelo de lenguaje de Google (Gemini) y se conecta a una base de datos PostgreSQL en tiempo real usando el **MCP Client Tool** para obtener la información.\n\n**Funcionalidades Principales:**\n- **Consultas de productos:** por ID, nombre, categoría, etc.\n- **Asesoramiento:** sobre materiales para proyectos.\n- **Generación de cotizaciones** detalladas.\n\n---\n\nThis conversational AI agent answers questions about hardware store products. It uses a Google language model (Gemini) and connects to a PostgreSQL database in real-time using the **MCP Client Tool** to get the information.\n\n**Main Features:**\n- **Product queries:** by ID, name, category, etc.\n- **Advice:** on materials for projects.\n- **Generation** of detailed quotes.",
        "height": 736,
        "width": 352,
        "color": 4
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        -1088,
        0
      ],
      "id": "8f1238d5-d0a0-4981-a236-fd5a58a83d68",
      "name": "Sticky Note"
    },
    {
      "parameters": {
        "content": "## ⚙️ Configuración Requerida / Required Configuration\n\nPara que este flujo funcione, asegúrate de configurar lo siguiente:\n\n1.  **Credenciales de PostgreSQL:**\n    - Deben estar configuradas y seleccionadas en cada nodo `PostgresTool`.\n\n2.  **Credenciales de Google Gemini:**\n    - Deben estar configuradas en el nodo `Language Model (Google Gemini)`.\n\n---\n\nFor this workflow to run, make sure to set up the following:\n\n1.  **PostgreSQL Credentials:**\n    - Must be configured and selected in each `PostgresTool` node.\n\n2.  **Google Gemini Credentials:**\n    - Must be configured in the `Language Model (Google Gemini)` node.",
        "height": 768,
        "width": 352,
        "color": 5
      },
      "type": "n8n-nodes-base.stickyNote",
      "typeVersion": 1,
      "position": [
        608,
        32
      ],
      "id": "93ca2a57-7d7b-43ff-ac50-cfa3514217bc",
      "name": "Sticky Note1"
    },
    {
      "parameters": {
        "content": "## AI Agent with PostgreSQL & MCP for Hardware Store Chatbot\n\nA conversational AI agent workflow in n8n powered by Google Gemini. It connects to a PostgreSQL database via the MCP Client tool to handle real-time product queries for a hardware store.\n\n---\n\n## Agente IA con PostgreSQL y MCP para Chatbot de Ferretería\n\nFlujo de trabajo en n8n de un agente de IA conversacional impulsado por Google Gemini. Se conecta a una base de datos PostgreSQL a través de la herramienta MCP Client para gestionar consultas de productos en tiempo real para una ferretería.",
        "height": 176,
        "width": 1248
      },
      "type": "n8n-nodes-base.stickyNote",
      "position": [
        -672,
        -112
      ],
      "typeVersion": 1,
      "id": "06499bb5-76aa-40c6-b6ee-44b0e1aa3d1c",
      "name": "Sticky Note2"
    }
  ],
  "pinData": {},
  "connections": {
    "Chat Trigger": {
      "main": [
        [
          {
            "node": "AI Agent",
            "type": "main",
            "index": 0
          }
        ]
      ]
    },
    "Query Product by ID": {
      "ai_tool": [
        [
          {
            "node": "Database Tools Trigger",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Query Product by Name": {
      "ai_tool": [
        [
          {
            "node": "Database Tools Trigger",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Query Product by Category": {
      "ai_tool": [
        [
          {
            "node": "Database Tools Trigger",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Query Product by Description": {
      "ai_tool": [
        [
          {
            "node": "Database Tools Trigger",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Query Product by Subcategory": {
      "ai_tool": [
        [
          {
            "node": "Database Tools Trigger",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Query Product by Note": {
      "ai_tool": [
        [
          {
            "node": "Database Tools Trigger",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    },
    "Language Model (Google Gemini)": {
      "ai_languageModel": [
        [
          {
            "node": "AI Agent",
            "type": "ai_languageModel",
            "index": 0
          }
        ]
      ]
    },
    "Chat Memory": {
      "ai_memory": [
        [
          {
            "node": "AI Agent",
            "type": "ai_memory",
            "index": 0
          }
        ]
      ]
    },
    "DB Tools Client": {
      "ai_tool": [
        [
          {
            "node": "AI Agent",
            "type": "ai_tool",
            "index": 0
          }
        ]
      ]
    }
  },
  "active": false,
  "settings": {
    "executionOrder": "v1"
  },
  "versionId": "482bcc14-4176-4f7e-845f-526daf162329",
  "meta": {
    "instanceId": "e474a31b8b87250ce78e26d790e06a4c97cbba29c1277a81c69eea9025513e9e"
  },
  "id": "KN9jNN3EZPjpNGbC",
  "tags": []
}